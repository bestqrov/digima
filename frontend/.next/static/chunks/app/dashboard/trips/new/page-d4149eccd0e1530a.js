(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[863],{7559:function(e,s,t){Promise.resolve().then(t.bind(t,9210))},9210:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return v}});var a=t(7437),i=t(2265),r=t(9376),l=t(9501),n=t(3590),c=t(7119),d=t(2253),o=t(3836),m=t(1601),u=t(1591),x=t(3519),p=t(954),h=t(654),g=t(4508),f=t(9064);let b=c.Ry({vehicleId:c.Z_().min(1,"Vehicle is required"),driverId:c.Z_().optional(),customerInfo:c.Ry({name:c.Z_().min(1,"Customer name is required"),email:c.Z_().email("Invalid email address"),phone:c.Z_().min(1,"Phone number is required"),numberOfPassengers:c.Rx().min(1,"Number of passengers must be at least 1")}),itinerary:c.Ry({pickupLocation:c.Ry({address:c.Z_().min(1,"Pickup location is required"),coordinates:c.Ry({lat:c.Rx().optional(),lng:c.Rx().optional()}).optional()}),dropoffLocation:c.Ry({address:c.Z_().min(1,"Dropoff location is required"),coordinates:c.Ry({lat:c.Rx().optional(),lng:c.Rx().optional()}).optional()}),pickupTime:c.Z_().min(1,"Pickup time is required"),estimatedDuration:c.Rx().min(1,"Estimated duration is required")}),pricing:c.Ry({basePrice:c.Rx().min(0,"Base price cannot be negative"),additionalCharges:c.IX(c.Ry({name:c.Z_().min(1,"Charge name is required"),amount:c.Rx().min(0,"Amount cannot be negative")})).optional()}),specialRequests:c.Z_().optional()});function v(){var e,s,t,c,v,j,N,y,w,k,C;let I=(0,r.useRouter)(),{createTrip:Z,isLoading:R}=(0,p.BD)(),[_,P]=(0,i.useState)([]),[E,L]=(0,i.useState)([]),[A,D]=(0,i.useState)(!0),[q,O]=(0,i.useState)(0),{register:S,handleSubmit:T,control:B,formState:{errors:V},watch:W,setValue:H}=(0,l.cI)({resolver:(0,n.F)(b),defaultValues:{customerInfo:{numberOfPassengers:1},pricing:{basePrice:0,additionalCharges:[]},itinerary:{estimatedDuration:60}}}),{fields:M,append:z,remove:F}=(0,l.Dq)({control:B,name:"pricing.additionalCharges"}),J=W("pricing.basePrice"),U=W("pricing.additionalCharges");(0,i.useEffect)(()=>{(async()=>{try{D(!0);let[e,s]=await Promise.all([h.JW.getVehicles({limit:100}),h.W4.getUsers({limit:100,role:"agency_user"})]);P(e.data),L(s.data)}catch(e){f.Am.error("Failed to load vehicles and drivers")}finally{D(!1)}})()},[]),(0,i.useEffect)(()=>{O((J||0)+((null==U?void 0:U.reduce((e,s)=>e+(s.amount||0),0))||0))},[J,U]);let G=async e=>{try{var s;let t={...e,driverId:e.driverId||void 0,pricing:{...e.pricing,additionalCharges:(null===(s=e.pricing.additionalCharges)||void 0===s?void 0:s.filter(e=>e.name&&e.amount>0))||[]}};await Z(t),f.Am.success("Trip created successfully!"),I.push("/dashboard/trips")}catch(e){}};return A?(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)(u.Z,{title:"Create New Trip",subtitle:"Book a new transportation service"}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)(x.Z,{size:"lg"})})})]}):(0,a.jsxs)("div",{className:"min-h-screen",children:[(0,a.jsx)(u.Z,{title:"Create New Trip",subtitle:"Book a new transportation service"}),(0,a.jsx)("div",{className:"p-6",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsxs)("button",{onClick:()=>I.back(),className:"btn-secondary flex items-center mr-4",children:[(0,a.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Back"]}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Create New Trip"})]}),(0,a.jsxs)("form",{onSubmit:T(G),className:"space-y-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Customer Information"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Customer Name *"}),(0,a.jsx)("input",{type:"text",...S("customerInfo.name"),className:"form-input",placeholder:"John Doe"}),(null===(e=V.customerInfo)||void 0===e?void 0:e.name)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:V.customerInfo.name.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Email Address *"}),(0,a.jsx)("input",{type:"email",...S("customerInfo.email"),className:"form-input",placeholder:"john@example.com"}),(null===(s=V.customerInfo)||void 0===s?void 0:s.email)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:V.customerInfo.email.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Phone Number *"}),(0,a.jsx)("input",{type:"tel",...S("customerInfo.phone"),className:"form-input",placeholder:"+1234567890"}),(null===(t=V.customerInfo)||void 0===t?void 0:t.phone)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:V.customerInfo.phone.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Number of Passengers *"}),(0,a.jsx)("input",{type:"number",...S("customerInfo.numberOfPassengers",{valueAsNumber:!0}),className:"form-input",placeholder:"2",min:"1"}),(null===(c=V.customerInfo)||void 0===c?void 0:c.numberOfPassengers)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:V.customerInfo.numberOfPassengers.message})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Trip Details"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Pickup Location *"}),(0,a.jsx)("input",{type:"text",...S("itinerary.pickupLocation.address"),className:"form-input",placeholder:"123 Main Street, City"}),(null===(j=V.itinerary)||void 0===j?void 0:null===(v=j.pickupLocation)||void 0===v?void 0:v.address)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:V.itinerary.pickupLocation.address.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Dropoff Location *"}),(0,a.jsx)("input",{type:"text",...S("itinerary.dropoffLocation.address"),className:"form-input",placeholder:"456 Destination Ave, City"}),(null===(y=V.itinerary)||void 0===y?void 0:null===(N=y.dropoffLocation)||void 0===N?void 0:N.address)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:V.itinerary.dropoffLocation.address.message})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Pickup Date & Time *"}),(0,a.jsx)("input",{type:"datetime-local",...S("itinerary.pickupTime"),className:"form-input",defaultValue:(()=>{let e=new Date;return e.setHours(e.getHours()+1),e.toISOString().slice(0,16)})()}),(null===(w=V.itinerary)||void 0===w?void 0:w.pickupTime)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:V.itinerary.pickupTime.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Estimated Duration (minutes) *"}),(0,a.jsx)("input",{type:"number",...S("itinerary.estimatedDuration",{valueAsNumber:!0}),className:"form-input",placeholder:"60",min:"1"}),(null===(k=V.itinerary)||void 0===k?void 0:k.estimatedDuration)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:V.itinerary.estimatedDuration.message})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Vehicle & Driver Assignment"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Vehicle *"}),(0,a.jsxs)("select",{...S("vehicleId"),className:"form-input",children:[(0,a.jsx)("option",{value:"",children:"Select a vehicle"}),_.map(e=>(0,a.jsxs)("option",{value:e._id,children:[e.plateNumber," - ",e.brand," ",e.model," (",e.capacity.passengers," seats)"]},e._id))]}),V.vehicleId&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:V.vehicleId.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Driver (optional)"}),(0,a.jsxs)("select",{...S("driverId"),className:"form-input",children:[(0,a.jsx)("option",{value:"",children:"No driver assigned"}),E.map(e=>(0,a.jsx)("option",{value:e._id,children:e.fullName},e._id))]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Pricing"}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Total"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:(0,g.xG)(q)})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Base Price *"}),(0,a.jsx)("input",{type:"number",step:"0.01",...S("pricing.basePrice",{valueAsNumber:!0}),className:"form-input",placeholder:"100.00",min:"0"}),(null===(C=V.pricing)||void 0===C?void 0:C.basePrice)&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-600",children:V.pricing.basePrice.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)("label",{className:"form-label",children:"Additional Charges"}),(0,a.jsxs)("button",{type:"button",onClick:()=>z({name:"",amount:0}),className:"btn-secondary flex items-center text-sm",children:[(0,a.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),"Add Charge"]})]}),M.length>0?(0,a.jsx)("div",{className:"space-y-3",children:M.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"text",...S("pricing.additionalCharges.".concat(s,".name")),className:"form-input flex-1",placeholder:"e.g., Airport fee, Extra luggage"}),(0,a.jsx)("input",{type:"number",step:"0.01",...S("pricing.additionalCharges.".concat(s,".amount"),{valueAsNumber:!0}),className:"form-input w-32",placeholder:"0.00",min:"0"}),(0,a.jsx)("button",{type:"button",onClick:()=>F(s),className:"p-2 text-red-600 hover:text-red-800",children:(0,a.jsx)(m.Z,{className:"h-4 w-4"})})]},e.id))}):(0,a.jsx)("p",{className:"text-gray-500 text-sm",children:'No additional charges. Click "Add Charge" to include extras.'})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Special Requests"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"form-label",children:"Notes (optional)"}),(0,a.jsx)("textarea",{...S("specialRequests"),rows:3,className:"form-input",placeholder:"Any special requirements or notes for this trip..."})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end space-x-4 pt-6",children:[(0,a.jsx)("button",{type:"button",onClick:()=>I.back(),className:"btn-secondary",children:"Cancel"}),(0,a.jsxs)("button",{type:"submit",disabled:R,className:"btn-primary",children:[R?(0,a.jsx)(x.Z,{size:"sm",className:"mr-2"}):null,R?"Creating...":"Create Trip"]})]})]})]})})]})}},1591:function(e,s,t){"use strict";t.d(s,{Z:function(){return d}});var a=t(7437),i=t(2265),r=t(1556),l=t(3121),n=t(954),c=t(4508);function d(e){var s;let{title:t,subtitle:d}=e,[o,m]=(0,i.useState)(""),{user:u}=(0,n.tN)(),{subscription:x}=(0,n.ZO)();return(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[t&&(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:t}),d&&(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:d})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"relative hidden md:block",children:[(0,a.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,a.jsx)(r.Z,{className:"h-4 w-4 text-gray-400"})}),(0,a.jsx)("input",{type:"text",placeholder:"Search...",value:o,onChange:e=>m(e.target.value),className:"block pl-9 pr-3 py-2 border border-gray-300 rounded-md text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500 w-64"})]}),(0,a.jsx)("div",{className:"hidden sm:block",children:(0,a.jsx)("span",{className:(0,c.cn)("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",(()=>{if(!x)return"bg-gray-100 text-gray-800";switch(x.status){case"active":return"bg-green-100 text-green-800";case"pending_payment":return"bg-yellow-100 text-yellow-800";case"pending_approval":return"bg-blue-100 text-blue-800";case"expired":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})()),children:x?x.status.replace("_"," ").replace(/\b\w/g,e=>e.toUpperCase()):"No subscription"})}),(0,a.jsxs)("button",{type:"button",className:"p-2 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,a.jsx)("span",{className:"sr-only",children:"View notifications"}),(0,a.jsx)(l.Z,{className:"h-5 w-5","aria-hidden":"true"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-8 h-8 bg-primary-100 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-medium text-primary-700",children:null==u?void 0:null===(s=u.fullName)||void 0===s?void 0:s.split(" ").map(e=>e[0]).join("").slice(0,2)})}),(0,a.jsxs)("div",{className:"hidden md:block",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:null==u?void 0:u.fullName}),(0,a.jsx)("p",{className:"text-xs text-gray-500",children:null==u?void 0:u.email})]})]})]})]})})}},3121:function(e,s,t){"use strict";var a=t(2265);let i=a.forwardRef(function(e,s){let{title:t,titleId:i,...r}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":i},r),t?a.createElement("title",{id:i},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"}))});s.Z=i},1556:function(e,s,t){"use strict";var a=t(2265);let i=a.forwardRef(function(e,s){let{title:t,titleId:i,...r}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":i},r),t?a.createElement("title",{id:i},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))});s.Z=i},3836:function(e,s,t){"use strict";var a=t(2265);let i=a.forwardRef(function(e,s){let{title:t,titleId:i,...r}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":i},r),t?a.createElement("title",{id:i},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))});s.Z=i},1601:function(e,s,t){"use strict";var a=t(2265);let i=a.forwardRef(function(e,s){let{title:t,titleId:i,...r}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":i},r),t?a.createElement("title",{id:i},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"}))});s.Z=i}},function(e){e.O(0,[64,762,214,480,971,117,744],function(){return e(e.s=7559)}),_N_E=e.O()}]);